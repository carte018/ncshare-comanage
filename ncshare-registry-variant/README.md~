# NCShare COManage extensions Docker build

This directory contains the files required to build the NCShare version of the CoManage Registry Docker container from the standard build of the CoManage Registry.

To use it, first build the default CoManage registry container according to the instructions in the main README.md file in this directory's parent directory.  Then rename the default CoManage registry container:

* comanage-registry:4.3.2-internet2-tier-1

built by the standard build process to:

* comanage-registry:4.3.2-internet2-tier-1-orig

and then use this directory to build a new comanage-registry:4.3.2-internet2-tier-1 container image based on he comanage-registry:4.3.2-internet2-tier-1-orig container image.

The build makes a number of adjustments to the default CoManage container installation:

* Disables weak TLS versions supported in the default Apache config
* Adds a Clusters controller to the CoManage installation in support of managing Linux Cluster configs
* Modifies the CoLdapProvisionerTarget.php code to better support group provisioning to LDAPs
* Modifies the default CoPetitioner.php code in support of automating SSH public key registrartion during petition processing properly
* Installs postfix and reated depedencies in support of CoManage sending email notifications using authenticated SMTP (since NCShare does not support originating email from the domain otherwise)
* Installs an "mgr.php" application for managing expiration / renewal of CoManage identities
* Installs updated HTTP config to enforce authentication for "mgr.php" application
* Installs a cron task to run the CoreJob.Expire Comanage job daily to trigger processing of identity expiration policies
* Installs a modified version of the UnixCluster plugin lang.php library which eliminates spaces in the CN values for user-specific groups created during enrollment (to avoid Linux "ls -l" parsing issues when group names present with embedded spaces)
